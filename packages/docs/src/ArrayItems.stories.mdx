import { Meta, Canvas } from '@storybook/addon-docs';
import { JsonForm } from '@sagold/react-json-editor';

<Meta title="ArrayItems" />

# array items

> _json-schema_ has a set of definitions for array items. This section details how those definitions transfer to a user interface build with _@sagold/react-json-editor_ and its default widgets.

Validation of data is fully supported, the following lists tracks support by the user interface:

- ❎ [**items** array-schema](#items-items-schema) - only in conjunction with an additionalItems defined as false or with a schema
- ✅ [**items** object-schema](#items-object-schema) - object schema for child-items
- ✅ [**items** oneOf](#items-oneof)
- ✅ [length](#length) support for **minItems** and **maxItems**
- ❎ [**additionalItems**](additionalItems) - not supported when set to true
- ✅ [**if-then-else**](#if-then-else)
- ❌ **enum** - only supported by validation not by user interface

validation only

- ❎ [**not**](#not) - incomprehensible error message
- ✅ uniqueItems - but unique items error is not assigned to actual value
- ❌ **contains** - not yet supported

## items object-array

array with fixed elements and `additionaItems=undefined` (equals empty schema -> everything is allowed === true)

<Canvas>
  <JsonForm
    addOptionalProps={false}
    options={{ title: true }}
    schema={{
      title: 'Content with any additional items',
      type: 'array',
      items: [
        {
          title: 'Title',
          type: 'string'
        },
        {
          title: 'Subtitle',
          type: 'string'
        }
      ]
    }}
  />
</Canvas>

## additionalItems

array with fixed elements and `additionaItems=false`

<Canvas>
  <JsonForm
    validate={true}
    addOptionalProps={false}
    data={['first', 'second', 'invalid']}
    schema={{
      title: 'Content with no additional items',
      type: 'array',
      items: [
        {
          title: 'Title',
          type: 'string'
        },
        {
          title: 'Subtitle',
          type: 'string'
        }
      ],
      additionalItems: false
    }}
  />
</Canvas>

array with fixed elements and `additionaItems=true`

- ⚠️ items object-array should allow adding any item. Here, item is initialized with `null` as no schema can be derived. Thus, no input element is renderer (null-widget) for adding items. Any input items are accepted.
- **This feature need support to define custom data, initially offering an json-editor.**

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={['first', 'second', 'unknown', 42, { title: 'schema is retrieved from input data' }]}
    schema={{
      title: 'Content with any additional item',
      type: 'array',
      items: [
        {
          title: 'Title',
          type: 'string'
        },
        {
          title: 'Subtitle',
          type: 'string'
        }
      ],
      additionalItems: true
    }}
  />
</Canvas>

array with fixed elements and `additionaItems={ type: "number" }`

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      title: 'Content with additional numbers',
      type: 'array',
      items: [
        {
          title: 'Title',
          type: 'string'
        },
        {
          title: 'Subtitle',
          type: 'string'
        }
      ],
      additionalItems: {
        type: 'number'
      }
    }}
  />
</Canvas>

## items object-schema

Array items can contain any supported json-schema. You can set items as simple values:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={[2023]}
    schema={{
      type: 'array',
      items: {
        title: 'item',
        type: 'number',
        default: 1
      },
      options: { title: true }
    }}
  />
</Canvas>

or complex objects

> ⚠️ **TODO** array object item does not show title

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={[2023]}
    schema={{
      type: 'array',
      options: { title: true },
      items: {
        type: 'object',
        required: ['alt', 'image'],
        title: 'Content image',
        properties: {
          alt: {
            title: 'Image alt text',
            type: 'string'
          },
          image: {
            title: 'Image',
            type: 'string',
            format: 'file'
          },
          width: {
            title: 'Width in px',
            type: 'number',
            default: 400
          }
        }
      }
    }}
  />
</Canvas>

## items oneOf

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={[{ type: 'header' }]}
    schema={{
      type: 'array',
      items: {
        oneOfProperty: 'type',
        oneOf: [
          {
            id: 'header',
            title: 'header',
            type: 'object',
            required: ['type', 'text'],
            properties: {
              type: {
                type: 'string',
                const: 'header',
                options: {
                  hidden: true
                }
              },
              text: {
                title: 'Header text',
                type: 'string'
              }
            }
          },
          {
            id: 'paragraph',
            title: 'paragraph',
            type: 'object',
            required: ['type', 'text'],
            properties: {
              type: {
                type: 'string',
                const: 'paragraph',
                options: {
                  hidden: true
                }
              },
              text: {
                title: 'Paragraph text',
                type: 'string'
              }
            }
          }
        ]
      },
      additionalItems: {
        title: 'Width in px',
        type: 'number',
        default: 400
      }
    }}
  />
</Canvas>

## length

support for `minItems` and `maxItems` length restrictions:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'array',
      minItems: 1,
      maxItems: 3,
      items: {
        title: 'item',
        type: 'number',
        default: 1
      },
      options: { title: true }
    }}
  />
</Canvas>

## if-then-else

example: if any number is above 1 the list is restricted to one item, else no item is allowed

<Canvas>
  <JsonForm
    addOptionalProps={false}
    validate={true}
    schema={{
      type: 'array',
      items: {
        title: 'Item',
        type: 'number',
        default: 2
      },
      minItems: 1,
      if: {
        items: {
          maximum: 1
        }
      },
      then: {
        maxItems: 1
      },
      else: {
        maxItems: 0
      },
      options: { title: true }
    }}
  />
</Canvas>

## enum

- ⚠️ **TODO** enum selection
- ⚠️ **TODO** fix initial data from getTemplate
- **TODO** improve error message valid options display

<Canvas>
  <JsonForm
    validate={true}
    addOptionalProps={false}
    schema={{
      type: 'array',
      enum: [
        [2019, 10, 22],
        [2023, 1, 1]
      ],
      items: {
        type: 'number'
      },
      minItems: 3,
      maxItems: 3,
      options: { title: true }
    }}
  />
</Canvas>

## not

support for `not` schema

- ⚠️ error message is unreadable

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={[123]}
    schema={{
      title: 'Array using not',
      description: 'value 123 is not allowed as array item',
      type: 'array',
      not: {
        type: 'array',
        items: {
          const: 123
        }
      },
      items: {
        title: 'item',
        type: 'number',
        default: 1
      },
      options: { title: true }
    }}
  />
</Canvas>

## unique items

support for `uniqueItems` schema

- **TODO** unique items error could be assigned to actual value

<Canvas>
  <JsonForm
    validate={true}
    addOptionalProps={false}
    data={[1, 2, 2]}
    schema={{
      title: 'Array with unique items',
      type: 'array',
      uniqueItems: true,
      items: {
        title: 'item',
        type: 'number',
        default: 1
      },
      options: { title: true }
    }}
  />
</Canvas>
