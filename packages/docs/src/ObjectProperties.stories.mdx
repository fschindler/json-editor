import { Meta, Canvas } from '@storybook/addon-docs';
import { JsonForm } from '@sagold/react-json-editor';

<Meta title="ObjectProperties" />

# object properties

> _json-schema_ has a set of definitions for object properties. This section details how those definitions transfer to a user interface build with _@sagold/react-json-editor_ and its default widgets.

Validation of data is fully supported, the following table lists support by the user interface:

- ✅ [**properties**](#properties)
- ✅ [**required**](#required-properties) - switch behaviour with `addOptionalProps`. Defaults to `true`
- ❎ [**additionalProperties**](#additional-properties) - partially. _additionalProperties_ defaults to false and removes values
- ❎ [**oneOf**](#oneof) - Attention: _oneOfProperty_ highly recommended
- ❎ [**allOf**](#allof) - partially. Attention: subschemas are merged
- ✅ [**dependencies**](#dependencies) - Attention: subschemas are merged
- ✅ [**if-then-else**](#if-then-else) - Attention: subschemas are merged
- ❌ **patternProperties** - not yet supported
- ❌ **anyOf** - not yet supported

**missing features**

- add button to add non-required, missing properties
- optional delete button to remove non-required properties

**bugs**

- incorrect property order for `additionalProperties`

## properties

Per default or with `addOptionalProps` set to `true`, all available properties will be added when missing:

<Canvas>
  <JsonForm
    addOptionalProps={true}
    schema={{
      type: 'object',
      properties: {
        one: { title: 'Property One', type: 'string' },
        two: { title: 'Property Two', type: 'string' }
      },
      options: { title: false }
    }}
  />
</Canvas>

## required properties

> ⚠️ **currently `addOptionalProps` defaults to `true`**. This example sets it to `false`. The default value will change to `false` as soon as adding optional properties is supported via the user interface.

The following example has two properties defined, but only property `"one"` is required:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One (required)', type: 'string' },
        two: { title: 'Property Two', type: 'string' }
      },
      options: { title: false }
    }}
  />
</Canvas>

Given an input value for property `"two"` will add this property to the form:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={{ two: 'set on input data' }}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One (required)', type: 'string' },
        two: { title: 'Property Two', type: 'string' }
      },
      options: { title: false }
    }}
  />
</Canvas>

## additional properties

For additional properties to be added, you have to set `additionalProperties: true` explicitly:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={{ two: 'additional property' }}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One (required)', type: 'string' }
      },
      additionalProperties: true,
      options: { title: false }
    }}
  />
</Canvas>

If `additionalProperties` is missing, unspecified properties are removed

<Canvas>
  <JsonForm
    addOptionalProps={false}
    data={{ two: 'additional property' }}
    onChange={console.log}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One (required)', type: 'string' }
      },
      options: { title: false }
    }}
  />
</Canvas>

Setting a schema for `additionalProperties` adds a validated field corresponding the subschema. Note values might be removed or replaced when the given type invalid as shown in the following example:

<Canvas>
  <JsonForm
    validate={true}
    addOptionalProps={false}
    data={{ two: 'additional property' }}
    onChange={console.log}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One (required)', type: 'string' }
      },
      additionalProperties: { type: 'number' },
      options: { title: false }
    }}
  />
</Canvas>

## oneOf

_oneOf_ statements offer the ability to choose a specific schema for a user form.

> Attention: _oneOfProperty_ is highly recommended

<Canvas>
  <JsonForm
    schema={{
      options: { title: false },
      oneOfProperty: 'id',
      oneOf: [
        {
          type: 'object',
          title: 'Selection One',
          required: ['one'],
          properties: {
            id: { type: 'string', const: 'one' },
            one: {
              type: 'string',
              title: 'Property One'
            }
          }
        },
        {
          type: 'object',
          title: 'Selection Two',
          required: ['two'],
          properties: {
            id: { type: 'string', const: 'two' },
            two: {
              type: 'number',
              title: 'Property Two'
            }
          }
        }
      ]
    }}
  />
</Canvas>

## allOf

_allOf_ requires all sub schemas to be valid for the given input. For a user input this all sub schemas have to be merged, thus you must ensure properties and validation rules are exclusive. At some point, the merging of subschemas might improve here, but currently any attributes woud be overriden by the last definition.

The following example has conflicting validation rules, where the last statement will be applied:

<Canvas>
  <JsonForm
    validate={true}
    schema={{
      type: 'object',
      options: { title: false },
      properties: {
        title: { type: 'string' }
      },
      allOf: [
        {
          properties: {
            title: { minLength: 1 }
          }
        },
        {
          properties: {
            title: {
              default: 'title',
              minLength: 6
            }
          }
        }
      ]
    }}
  />
</Canvas>

_allOf_ also supports any json-schema supported by json-editor, e.g. if-then-else statements

<Canvas>
  <JsonForm
    validate={true}
    liveUpdate={true}
    schema={{
      type: 'object',
      options: { title: false },
      properties: {
        title: { type: 'string', default: 'four' }
      },
      allOf: [
        {
          if: {
            type: 'object',
            required: ['title'],
            properties: {
              title: {
                minLength: 4
              }
            }
          },
          then: {
            properties: {
              title: {
                pattern: '^[0-9]+$',
                patternExample: 'a string with a length of 4+ should contain only numbers'
              }
            }
          }
        }
      ]
    }}
  />
</Canvas>

## dependencies

**dependency required: `prop: ["prop"]`**

> With `addOptionalProps=true` all dependencies are added per default as expected. Thus, the following examples set `addOptionalProps=false`

Dependencies are not added per default

<Canvas>
  <JsonForm
    data={{}}
    addOptionalProps={false}
    schema={{
      type: 'object',
      properties: {
        one: { title: 'Property One', type: 'string' },
        two: { title: 'dependency', type: 'string' }
      },
      dependencies: {
        one: ['two']
      },
      options: { title: false }
    }}
  />
</Canvas>

Dependencies are added when they are required by another property which has been set (`!== undefined`)

<Canvas>
  <JsonForm
    data={{ one: 'input value' }}
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One', type: 'string' },
        two: { title: 'dependency', type: 'string' }
      },
      dependencies: {
        one: ['two']
      },
      options: { title: false }
    }}
  />
</Canvas>

**dependency schema: `prop: {}`**

Dependent schemas are not added per default for a missing dependent property

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'object',
      properties: {
        one: { title: 'Property One', type: 'string' }
      },
      dependencies: {
        one: {
          required: ['two'],
          properties: {
            two: { title: 'dependency', type: 'string' }
          }
        }
      },
      options: { title: false }
    }}
  />
</Canvas>

Dependent schemas are added if the dependent property is set (`!== undefined`)

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['one'],
      properties: {
        one: { title: 'Property One', type: 'string' }
      },
      dependencies: {
        one: {
          required: ['two'],
          properties: {
            two: { title: 'dependency', type: 'string' }
          }
        }
      },
      options: { title: false }
    }}
  />
</Canvas>

## if-then-else

_if-then_ statement, adding or removing a schema with its data depending on the property of trigger. The following toggle should not show the property per default as the property `addition` is not set as required

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['trigger'],
      properties: {
        trigger: { title: 'Trigger', type: 'boolean', default: false }
      },
      if: {
        required: ['trigger'],
        properties: {
          trigger: { const: true }
        }
      },
      then: {
        properties: {
          addition: { type: 'string' }
        }
      },
      options: { title: false }
    }}
  />
</Canvas>

Same setup as above, but with property `addition` set as required:

<Canvas>
  <JsonForm
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['trigger'],
      properties: {
        trigger: { title: 'Trigger', type: 'boolean', default: false }
      },
      if: {
        required: ['trigger'],
        properties: {
          trigger: { const: true }
        }
      },
      then: {
        required: ['addition'],
        properties: {
          addition: { type: 'string' }
        }
      },
      options: { title: false }
    }}
  />
</Canvas>

> If you want to persist the value entered independent of the current visbility, follow the [tutorial](?path=/story/examples-jsonschemasupport--all-of-with-conditions).

_if-then-else_ statement used to switch sub-schemas

<Canvas>
  <JsonForm
    validate={true}
    addOptionalProps={false}
    schema={{
      type: 'object',
      required: ['switch'],
      properties: {
        switch: { title: 'Switch', type: 'boolean', default: false }
      },
      if: {
        required: ['switch'],
        properties: {
          switch: { const: false }
        }
      },
      then: {
        required: ['then', 'number'],
        properties: {
          then: { title: 'Then statement', type: 'string' },
          number: { title: 'Value in Then', type: 'number', minimum: 4 }
        }
      },
      else: {
        required: ['else', 'number'],
        properties: {
          else: { title: 'Else statement', type: 'string', enum: ['option a', 'option b'] },
          number: { title: 'Value in Else', type: 'number', maximum: 4 }
        }
      },
      options: { title: false }
    }}
  />
</Canvas>

## references

- [json-schema.org object properties](https://json-schema.org/understanding-json-schema/reference/object.html)
- [json-schema.org dependencies](https://json-schema.org/understanding-json-schema/reference/conditionals.html)
