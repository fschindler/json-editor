!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("json-schema-library")):"function"==typeof define&&define.amd?define("headlessJsonEditor",["json-schema-library"],t):"object"==typeof exports?exports.headlessJsonEditor=t(require("json-schema-library")):e.headlessJsonEditor=t(e.jlib)}("undefined"!=typeof self?self:this,(e=>(()=>{var t={367:function(e,t){!function(e){"use strict";function t(e){return function(t,r,n,o,i,s,a){return e(t,r,a)}}function r(e){return function(t,r,n,o){if(!t||!r||"object"!=typeof t||"object"!=typeof r)return e(t,r,n,o);var i=o.get(t),s=o.get(r);if(i&&s)return i===r&&s===t;o.set(t,r),o.set(r,t);var a=e(t,r,n,o);return o.delete(t),o.delete(r),a}}function n(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r}function o(e){return e.constructor===Object||null==e.constructor}function i(e){return"function"==typeof e.then}function s(e,t){return e===t||e!=e&&t!=t}var a="[object Arguments]",u="[object Boolean]",l="[object Date]",c="[object RegExp]",p="[object Map]",d="[object Number]",h="[object Object]",f="[object Set]",m="[object String]",y=Object.prototype.toString;function v(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areMapsEqual,v=e.areObjectsEqual,g=e.areRegExpsEqual,E=e.areSetsEqual,b=(0,e.createIsNestedEqual)(O);function O(e,O,j){if(e===O)return!0;if(!e||!O||"object"!=typeof e||"object"!=typeof O)return e!=e&&O!=O;if(o(e)&&o(O))return v(e,O,b,j);var S=Array.isArray(e),x=Array.isArray(O);if(S||x)return S===x&&t(e,O,b,j);var w=y.call(e);return w===y.call(O)&&(w===l?r(e,O,b,j):w===c?g(e,O,b,j):w===p?n(e,O,b,j):w===f?E(e,O,b,j):w===h||w===a?!i(e)&&!i(O)&&v(e,O,b,j):(w===u||w===d||w===m)&&s(e.valueOf(),O.valueOf()))}return O}function g(e,t,r,n){var o=e.length;if(t.length!==o)return!1;for(;o-- >0;)if(!r(e[o],t[o],o,o,e,t,n))return!1;return!0}var E=r(g);function b(e,t){return s(e.valueOf(),t.valueOf())}function O(e,t,r,n){var o=e.size===t.size;if(!o)return!1;if(!e.size)return!0;var i={},s=0;return e.forEach((function(a,u){if(o){var l=!1,c=0;t.forEach((function(o,p){l||i[c]||!(l=r(u,p,s,c,e,t,n)&&r(a,o,u,p,e,t,n))||(i[c]=!0),c++})),s++,o=l}})),o}var j=r(O),S="_owner",x=Object.prototype.hasOwnProperty;function w(e,t,r,n){var o,i=Object.keys(e),s=i.length;if(Object.keys(t).length!==s)return!1;for(;s-- >0;){if((o=i[s])===S){var a=!!e.$$typeof,u=!!t.$$typeof;if((a||u)&&a!==u)return!1}if(!x.call(t,o)||!r(e[o],t[o],o,o,e,t,n))return!1}return!0}var P=r(w);function N(e,t){return e.source===t.source&&e.flags===t.flags}function q(e,t,r,n){var o=e.size===t.size;if(!o)return!1;if(!e.size)return!0;var i={};return e.forEach((function(s,a){if(o){var u=!1,l=0;t.forEach((function(o,c){u||i[l]||!(u=r(s,o,a,c,e,t,n))||(i[l]=!0),l++})),o=u}})),o}var $=r(q),I=Object.freeze({areArraysEqual:g,areDatesEqual:b,areMapsEqual:O,areObjectsEqual:w,areRegExpsEqual:N,areSetsEqual:q,createIsNestedEqual:t}),V=Object.freeze({areArraysEqual:E,areDatesEqual:b,areMapsEqual:j,areObjectsEqual:P,areRegExpsEqual:N,areSetsEqual:$,createIsNestedEqual:t}),A=v(I);function J(e,t){return A(e,t,void 0)}var T=v(n(I,{createIsNestedEqual:function(){return s}}));function M(e,t){return T(e,t,void 0)}var C=v(V);function R(e,t){return C(e,t,new WeakMap)}var k=v(n(V,{createIsNestedEqual:function(){return s}}));function F(e,t){return k(e,t,new WeakMap)}function D(e){return v(n(I,e(I)))}function U(e){var t=v(n(V,e(V)));return function(e,r,n){return void 0===n&&(n=new WeakMap),t(e,r,n)}}e.circularDeepEqual=R,e.circularShallowEqual=F,e.createCustomCircularEqual=U,e.createCustomEqual=D,e.deepEqual=J,e.sameValueZeroEqual=s,e.shallowEqual=M,Object.defineProperty(e,"__esModule",{value:!0})}(t)},909:function(e){"undefined"!=typeof self&&self,e.exports=(()=>{"use strict";var e={431:(e,t,r)=>{function n(e){return"#"===e||""===e||Array.isArray(e)&&0===e.length||!1}r.r(t),r.d(t,{default:()=>w,get:()=>p,isRoot:()=>n,join:()=>x,remove:()=>E,removeUndefinedItems:()=>g,set:()=>m,split:()=>c});const o=/~1/g,i=/~0/g,s=/\/+/g,a=/(^[#/]*|\/+$)/g;function u(e){return e.replace(o,"/").replace(i,"~")}function l(e){return u(decodeURIComponent(e))}function c(e){if(null==e||"string"!=typeof e||n(e))return Array.isArray(e)?e:[];const t=e.indexOf("#")>=0?l:u,r=(e=(e=e.replace(s,"/")).replace(a,"")).split("/");for(let e=0,n=r.length;e<n;e+=1)r[e]=t(r[e]);return r}function p(e,t,r){if(null==t||null==e)return r;if(n(t))return e;const o=d(e,c(t));return void 0===o?r:o}function d(e,t){const r=t.shift();if(void 0!==e)return void 0!==r?d(e[r],t):e}const h=/^\[.*\]$/,f=/^\[(.+)\]$/;function m(e,t,r){if(null==t)return e;const n=c(t);if(0===n.length)return e;null==e&&(e=h.test(n[0])?[]:{});let o,i,s=e;for(;n.length>1;)o=n.shift(),i=h.test(n[0]),s=v(s,o,i);return o=n.pop(),y(s,o,r),e}function y(e,t,r){let n;const o=t.match(f);"[]"===t&&Array.isArray(e)?e.push(r):o?(n=o.pop(),e[n]=r):e[t]=r}function v(e,t,r){if(null!=e[t])return e[t];const n=r?[]:{};return y(e,t,n),n}function g(e){let t=0,r=0;for(;t+r<e.length;)void 0===e[t+r]&&(r+=1),e[t]=e[t+r],t+=1;return e.length=e.length-r,e}function E(e,t,r){const n=c(t),o=n.pop(),i=p(e,n);return i&&delete i[o],Array.isArray(i)&&!0!==r&&g(i),e}const b=/\/+/g,O=/~/g,j=/\//g;function S(e,t){if(0===e.length)return t?"#":"";for(let r=0,n=e.length;r<n;r+=1)e[r]=e[r].replace(O,"~0").replace(j,"~1"),t&&(e[r]=encodeURIComponent(e[r]));return((t?"#/":"/")+e.join("/")).replace(b,"/")}function x(e,...t){const r=[];if(Array.isArray(e))return S(e,!0===arguments[1]);const n=arguments[arguments.length-1],o="boolean"==typeof n?n:e&&"#"===e[0];for(let e=0,t=arguments.length;e<t;e+=1)r.push.apply(r,c(arguments[e]));const i=[];for(let e=0,t=r.length;e<t;e+=1)if(".."===r[e]){if(0===i.length)return o?"#":"";i.pop()}else i.push(r[e]);return S(i,o)}const w={get:p,set:m,remove:E,join:x,split:c,isRoot:n,removeUndefinedItems:g}}},t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}return r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(431)})()},265:t=>{"use strict";t.exports=e}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var i=r[e]={exports:{}};return t[e].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";n.r(o),n.d(o,{EventLoggerPlugin:()=>ie,HeadlessJsonEditor:()=>oe,HistoryPlugin:()=>ue,OnChangePlugin:()=>ae,RemoteEnumOptionsPlugin:()=>se,create:()=>g,errors:()=>P,find:()=>N,flat:()=>x,get:()=>T,getChildNode:()=>A,getErrors:()=>X,getOptions:()=>f,isJSONError:()=>e.isJSONError,isNode:()=>O,isParentNode:()=>j,isValueNode:()=>S,json:()=>E,move:()=>B,remove:()=>Z,set:()=>_,setErrorMessages:()=>t,splitErrors:()=>Y,trace:()=>C,unlinkAll:()=>G,updateErrors:()=>te,updateOptions:()=>Q,updateSchema:()=>K});var e=n(265);function t(t=r){Object.assign(e.config.strings,t)}const r={AdditionalItemsError:"Array at `{{pointer}}` may not have an additional item `{{key}}`",AdditionalPropertiesError:"Additional property `{{property}}` on `{{pointer}}` does not match schema `{{schema}}`",AllOfError:"Value `{{value}}` at `{{pointer}}` does not match schema of `{{allOf}}`",AnyOfError:"Value `{{value}}` at `{{pointer}}` does not match any schema of `{{anyOf}}`",ConstError:"Expected value at `{{pointer}}` to be `{{expected}}`, but value given is `{{value}}`",containsAnyError:"The array at `{{pointer}}` must contain at least one item",ContainsArrayError:"The property at `{{pointer}}` must not be an array",ContainsError:"The array at `{{pointer}}` must contain an element that matches `{{schema}}`",EnumError:"Expected given value `{{value}}` in `{{pointer}}` to be one of `{{values}}`",FormatDateError:"Value `{{value}}` at `{{pointer}}` is not a valid date",FormatDateTimeError:"Value `{{value}}` at `{{pointer}}` is not a valid date-time",FormatEmailError:"Value `{{value}}` at `{{pointer}}` is not a valid email",FormatHostnameError:"Value `{{value}}` at `{{pointer}}` is not a valid hostname",FormatIPV4Error:"Value `{{value}}` at `{{pointer}}` is not a valid IPv4 address",FormatIPV4LeadingZeroError:"IPv4 addresses starting with zero are invalid, since they are interpreted as octals",FormatIPV6Error:"Value `{{value}}` at `{{pointer}}` is not a valid IPv6 address",FormatIPV6LeadingZeroError:"IPv6 addresses starting with zero are invalid, since they are interpreted as octals",FormatJSONPointerError:"Value `{{value}}` at `{{pointer}}` is not a valid json-pointer",FormatRegExError:"Value `{{value}}` at `{{pointer}}` is not a valid regular expression",FormatTimeError:"Value `{{value}}` at `{{pointer}}` is not a valid time",FormatURIError:"Value `{{value}}` at `{{pointer}}` is not a valid uri",FormatURIReferenceError:"Value `{{value}}` at `{{pointer}}` is not a valid uri-reference",FormatURITemplateError:"Value `{{value}}` at `{{pointer}}` is not a valid uri-template",FormatURLError:"Value `{{value}}` at `{{pointer}}` is not a valid url",InvalidDataError:"No value may be specified in `{{pointer}}`",InvalidPropertyNameError:"Invalid property name `{{property}}` at `{{pointer}}`",MaximumError:"Value in `{{pointer}}` is `{{length}}`, but should be `{{maximum}}` at maximum",MaxItemsError:"Too many items in `{{pointer}}`, should be `{{maximum}}` at most, but got `{{length}}`",MaxLengthError:"Value `{{pointer}}` should have a maximum length of `{{maxLength}}`, but got `{{length}}`.",MaxPropertiesError:"Too many properties in `{{pointer}}`, should be `{{maximum}}` at most, but got `{{length}}`",MinimumError:"Value in `{{pointer}}` is `{{length}}`, but should be `{{minimum}}` at minimum",MinItemsError:"Too few items in `{{pointer}}`, should be at least `{{minimum}}`, but got `{{length}}`",MinItemsOneError:"An item is required",MinLengthError:"Value `{{pointer}}` should have a minimum length of `{{minLength}}`, but got `{{length}}`.",MinLengthOneError:"Input is required",MinPropertiesError:"Too few properties in `{{pointer}}`, should be at least `{{minimum}}`, but got `{{length}}`",MissingDependencyError:"The required propery '{{missingProperty}}' in `{{pointer}}` is missing",MissingOneOfPropertyError:"Value at `{{pointer}}` property: `{{property}}`",MultipleOfError:"Expected `{{value}}` in `{{pointer}}` to be multiple of `{{multipleOf}}`",MultipleOneOfError:"Value `{{value}}` should not match multiple schemas in oneOf `{{matches}}`",NoAdditionalPropertiesError:"Additional property `{{property}}` in `{{pointer}}` is not allowed",NotError:"Value `{{value}}` at pointer should not match schema `{{not}}`",OneOfError:"Value `{{value}}` in `{{pointer}}` does not match any given oneof schema",OneOfPropertyError:"Failed finding a matching oneOfProperty schema in `{{pointer}}` where `{{property}}` matches `{{value}}`",PatternError:"Value in `{{pointer}}` should match `{{description}}`, but received `{{received}}`",PatternPropertiesError:"Property `{{key}}` does not match any patterns in `{{pointer}}`. Valid patterns are: {{patterns}}",RequiredPropertyError:"The required property `{{key}}` is missing at `{{pointer}}`",TypeError:"Expected `{{value}}` ({{received}}) in `{{pointer}}` to be of type `{{expected}}`",UndefinedValueError:"Value must not be undefined in `{{pointer}}`",UniqueItemsError:"Expected unique items in {{pointer}}: duplicate value `{{value}}` found at {{itemPointer}} and {{duplicatePointer}}",UnknownPropertyError:"Could not find a valid schema for property `{{pointer}}` within object",ValueNotEmptyError:"A value for `{{property}}` is required at `{{pointer}}`"};var i;t();var s=new Uint8Array(16);function a(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(s)}const u=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const l=function(e){return"string"==typeof e&&u.test(e)};for(var c=[],p=0;p<256;++p)c.push((p+256).toString(16).substr(1));const d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!l(r))throw TypeError("Stringified UUID is invalid");return r};const h=function(e,t,r){var n=(e=e||{}).random||(e.rng||a)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return d(n)};function f(e,t){var r;const n=null!==(r=e.options)&&void 0!==r?r:{},o={title:e.title||t,description:e.description,disabled:!1===e.isActive||!1,hidden:!1,...n};return!1===n.showTitle&&delete o.title,!1===n.showDescription&&delete o.description,o}function m(e){return e.split("/").pop()}function y(t){return"object"===(0,e.getTypeOf)(t)}const v={array:(e,t,r,n)=>{const o=m(n),i={id:h(),type:"array",pointer:n,property:o,schema:r,options:{...f(r,o),required:null!=r.minItems&&r.minItems>0},children:[],errors:[]};return t.forEach(((o,s)=>{const a=e.step(s,r,t,n);i.children.push(g(e,o,a,`${n}/${s}`))})),i},object:(t,r,n,o)=>{const i=m(o),s={id:h(),type:"object",pointer:o,property:i,schema:n,options:f(n,i),children:[],errors:[]};n.allOf&&(n=t.resolveAllOf(r,n),r=t.getTemplate(r,n));let a=r,u=n.properties;if(y(n.dependencies)){const e=n.dependencies;Object.keys(e).forEach((n=>{var o,i;const s=e[n];if(!y(s))return;s.type="object";const l=r[n],c="string"==typeof l?l.length>0:null!=l,p=t.getTemplate({},s);a={...p,...r},Object.keys(s.properties).forEach((e=>{s.properties[e].isActive=c,s.properties[e].isDynamic=!0})),u={...u,...null!==(o=s.properties)&&void 0!==o?o:{}};const d=Object.keys(u),h=Object.keys(null!==(i=s.properties)&&void 0!==i?i:{}),f={};for(let e=0;e<d.length;e+=1){const t=d[e];f[t]=u[t],t===n&&h.forEach((e=>{f[e]=s.properties[e]}))}u=f}))}if(y(n.if)&&(n.then||n.else)){const e=t.isValid(a,n.if),r=e&&n.then||!e&&n.else;if(y(r)){const e=r.properties;if(y(e)){const n=t.getTemplate({},{type:"object",...r});a={...n,...a},u={...u,...e}}}}if(Object.keys(a).forEach((r=>{const i=t.step(r,n,a,o);(0,e.isJSONError)(i)||s.children.push(g(t,a[r],i,`${o}/${r}`))})),u){const e=Object.keys(u);console.log("sort props",e),s.children.sort(((t,r)=>e.indexOf(t.property)-e.indexOf(r.property)))}return s},string:(e,t,r,n)=>{const o=m(n);return{id:h(),type:"string",pointer:n,property:o,options:{...f(r,o),required:null!=r.minLength&&r.minLength>0},schema:r,value:t,errors:[]}},number:(e,t,r,n)=>{const o=m(n);return{id:h(),type:"number",pointer:n,property:o,options:f(r,o),schema:r,value:t,errors:[]}},boolean:(e,t,r,n)=>{const o=m(n);return{id:h(),type:"boolean",pointer:n,property:o,options:f(r,o),schema:r,value:t,errors:[]}},null:(e,t,r,n)=>{const o=m(n);return{id:h(),type:"null",pointer:n,property:o,options:f(r,o),schema:r,value:t,errors:[]}}};function g(t,r,n=t.rootSchema,o="#"){const i=null==r?"null":(0,e.getTypeOf)(null!=r?r:n.const);if(v[i])return v[i](t,r,n,o);throw new Error(`unsupported datatype '${i}' in create node`)}function E(e){if(null==e)return null;if("array"===e.type)return e.children.map(E);if("object"===e.type){const t={};return e.children.forEach((e=>t[e.property]=E(e))),t}return e.value}const b=["array","object","string","number","null","boolean"];function O(e){return b.includes(null==e?void 0:e.type)}function j(e){return"array"===e.type||"object"===e.type}function S(e){return"string"===e.type||"number"===e.type||"null"===e.type||"boolean"===e.type}function x(e,t=[]){return t.push(e),j(e)&&e.children.forEach((e=>x(e,t))),t}const w=(e,t)=>(e.push(...t.errors),e);function P(e){return x(e).reduceRight(w,[])}function N(e,t){return x(e).find(t)}var q=n(909),$=n.n(q);e.config.strings.InvalidPathError="Path '{{pointer}}' does not exist in data";const I=(0,e.createCustomError)("InvalidPathError");e.config.strings.InvalidNodeTypeError="Invalid not type {{ type }} given";const V=(0,e.createCustomError)("InvalidNodeTypeError");function A(e,t){if(j(e))return e.children.find((e=>e.property===t))}function J(e,t){return j(e)?e.children.findIndex((e=>e.property===t)):-1}function T(e,t){return M(e,$().split(t),[])}function M(e,t,r){if(0===t.length)return e;const n=t.shift();r.push(n);const o=A(e,n);return o?M(o,t,r):I({pointer:$().join(r)})}function C(e,t){const r=(0,q.split)(t).reverse(),n=[e];let o=e;for(;r.length;){const e=A(o,r.pop());if(void 0===e)return n;o=e,n.push(o)}return n}function R(e,t,r){const n=E(e);return(0,q.set)(n,t,r),n}function k(e,t,r,n){if(!t.schema.if||!t.schema.then&&!t.schema.else)return[t,[]];const o=[],i={type:"object",...t.schema.then},s={type:"object",...t.schema.else},a=E(t),u=e.isValid(a,t.schema.if);let l=(0,q.set)((e=>JSON.parse(JSON.stringify(e)))(a),r,n);const c=e.isValid(l,t.schema.if);if(u===c)return[t,o];const p=c?i:s,d=g(e,a,u?i:s,t.pointer).children.map((e=>e.pointer));t.children=t.children.filter((e=>{const t=!d.includes(e.pointer);return!1===t&&o.push({type:"delete",node:e}),t})),l=e.getTemplate(l,p);const h=g(e,l,p,t.pointer).children;return o.push(...h.map((e=>({type:"create",node:e})))),t.children=t.children.concat(...h),[t,o]}function F(e,t,r,n){const o=[];if(!t.schema.dependencies)return[t,o];const i=r[0];if(!(null!=t.schema.dependencies[i]))return[t,o];const s=A(t,r[0]);if(void 0===s)throw new Error(`currently edited child '${t.pointer}/${r[0]}' could not be resolved on transform.set`);const a=R(t,(0,q.join)(r),n);o.push({type:"delete",node:t});const u=g(e,a,t.schema,t.pointer);o.push({type:"create",node:u});const l=J(u,r[0]);return u.children[l]=s,t.children=u.children,[t,o]}var D=n(367);function U(t,r,n,o){const i=E(r);i[n]=o;const s=t.step(n,r.schema,i,r.pointer);return(0,e.isJSONError)(s)?"unknown-property-error"!==s.code?(console.log(`failed retrieving schema for '${r.pointer}/${n}'`),console.log(s),s):t.createSchemaOf(o):s}function L(e,t,r,n){var o;const i=e.step(r,t.schema,n,t.pointer);let s=J(t,r);-1===s&&(s="array"===t.type?parseInt(r):t.children.length);const a=null===(o=t.children[s])||void 0===o?void 0:o.schema;if(null!=a&&(0,D.deepEqual)(i,a))return;const u=[];O(t.children[s])&&u.push({type:"delete",node:t.children[s]});const l=Array.isArray(n)?n[parseInt(r)]:n[r];return t.children=[...t.children],t.children[s]=g(e,l,i,`${t.pointer}/${r}`),u.push({type:"create",node:t.children[s]}),u}function z(t,r,n,o){if("array"===r.type&&!function(e){return`${parseInt(e)}`===e}(n))return I({pointer:r.pointer,reason:`child property '${n}' to array is not a number`,where:"resolving target node in transform.set"});const i=U(t,r,n,o);if((0,e.isJSONError)(i))return i;const s=[],a="object"===r.type?r.children.length:n;return O(r.children[a])&&s.push({type:"delete",node:r.children[a]}),r.children[a]=g(t,o,i,`${r.pointer}/${n}`),s.push({type:"create",node:r.children[a]}),s}function _(t,r,n,o){var i,s;const a=[],u=(0,q.split)(n);if(0===u.length){const e=g(t,o);return a.push({type:"delete",node:r}),a.push({type:"create",node:e}),e.id=r.id,[e,a]}const l={...r};let c=l,p=l,d="";for(;u.length>0;){if(!p||!j(p))return[I({pointer:n,reason:"expected parent data to be object or array",where:"resolving json pointer to node in transform.change"})];if(p.schema.oneOf||p.schema.oneOfSchema){const e=L(t,c,d,R(c,(0,q.join)(d,u),o));if(e)return a.push(...e),[l,a]}if("array"===(null==p?void 0:p.type)&&(null===(s=null===(i=p.schema)||void 0===i?void 0:i.items)||void 0===s?void 0:s.oneOf)){const e=R(p,(0,q.join)(u),o),r=L(t,p,u[0],e);if(r)return a.push(...r),[l,a]}if("object"===(null==p?void 0:p.type)&&p.schema.if){const[e,r]=k(t,p,(0,q.join)(u),o);p=e,a.push(...r)}if("object"===(null==p?void 0:p.type)&&p.schema.dependencies){const[e,r]=F(t,p,u,o);p=e,a.push(...r)}p.children=[...p.children],d=u.shift();const e=J(p,d);e>=0?(p.children[e]={...p.children[e]},c=p,p=p.children[e]):(c=p,p=null)}if(!j(c))throw new Error(`Expected node '${c.pointer}' (${c.type}) to be object or array to set value on '${n}'`);if(null==p){const r=z(t,c,d,o);return(0,e.isJSONError)(r)?[r]:(a.push(...r),[l,a])}if(S(p)){const r=function(t,r,n,o){const i=J(r,n.property),s=[];if(typeof n.value==typeof o)return n.value=o,s.push({type:"update",node:n}),s;const a=U(t,r,n.property,o);if((0,e.isJSONError)(a))return a;if((0,D.deepEqual)(a,n.schema))return n.value=o,s.push({type:"update",node:n}),s;const u=`${r.pointer}/${n.property}`;return O(r.children[i])&&s.push({type:"delete",node:r.children[i]}),r.children[i]=g(t,o,a,u),s.push({type:"create",node:r.children[i]}),s}(t,c,p,o);return(0,e.isJSONError)(r)?[r]:(a.push(...r),[l,a])}if(j(p)){const r=function(t,r,n,o){var i;const s=U(t,r,n.property,o);if((0,e.isJSONError)(s))return s;const a=[],u=J(r,n.property),l=g(t,o,s,n.pointer);return r.children[u]=l,l.type===n.type&&(l.id=n.id),(0,D.deepEqual)(n.schema,l.schema)?(a.push({type:"update",node:l}),n.children.forEach((e=>a.push({type:"delete",node:e}))),null===(i=l.children)||void 0===i||i.forEach((e=>a.push({type:"create",node:e}))),a):(a.push({type:"delete",node:n}),a.push({type:"create",node:l}),a)}(t,c,p,o);return(0,e.isJSONError)(r)?[r]:(a.push(...r),[l,a])}throw new Error("Invalid state in transform.set")}function H(e,t,r){const n={...e};return t=t.replace(/^[#/]*/,"#/"),n.property=r,n.pointer=$().join(t,r),"array"===n.type?n.children=n.children.map(((e,t)=>H(e,n.pointer,`${t}`))):"object"===n.type&&(n.children=n.children.map(((e,t)=>H(e,n.pointer,e.property)))),n}function W(e,t){if(t=(0,q.join)(t),!j(e))return V({pointer:t,expectedType:"array or object",type:null==e?void 0:e.type,reason:"root node must be of type array or object or else there is nothing to delete",where:`transform: 'remove' data at '${t}'`});const r=(0,q.split)(t),n={...e};let o,i=n,s=-1;for(;r.length>0;){if(o=r.shift(),s=J(i,o),!j(i)||s<0)return I({pointer:t,reason:`path does not lead to valid destination in data/tree at ${i.pointer}`,where:`transform: 'remove' data at '${t}'`});const e={...i.children[s]};i.children=[...i.children],i.children[s]=e,i=e}return[n,i]}function Z(t,r){const n=(0,q.split)(r),o=n.pop(),i=W(t,n);if((0,e.isJSONError)(i))return[i];const[s,a]=i,u=J(a,o);if(!j(a))return[I({pointer:r,reason:`path does not lead to valid destination in data/tree at ${a.pointer}`,where:`transform: 'remove' data at '${r}'`})];const l=[{type:"delete",node:a.children[u]}];if(a.children=[...a.children],a.children.splice(u,1),"array"===a.type)for(let e=u,t=a.children.length;e<t;e+=1)a.children[e]=H(a.children[e],a.pointer,`${e}`);return[s,l]}function B(t,r,n,o,i){const s=W(r,n);if((0,e.isJSONError)(s))return[s];const[a,u]=s;if("array"!==u.type)return[I({pointer:n,reason:`expected pointer to array, received ${u.type}`,where:"retrieving array in transform.insert"})];i=Math.min(i,u.children.length-1),o=Math.min(o,u.children.length-1);const l=[...u.children];l.splice(i,0,l.splice(o,1)[0]),u.children=l;const c=[],p=Math.min(o,i),d=Math.max(o,i);for(let e=p;e<=d;e+=1)l[e]=H(l[e],$().join(n),`${e}`),c.push({type:"update",node:l[e]});return[a,c]}function G(e){const t={...e};return j(t)&&(t.children=t.children.map((e=>G(e)))),t}function K(t,r,n){const o=W(t,r);if((0,e.isJSONError)(o))return[o];const[i,s]=o;return s.schema=n,[i,[{type:"update",node:s}]]}function Q(t,r,n){const o=W(t,r);if((0,e.isJSONError)(o))return[o];const[i,s]=o;return s.options=n,[i,[{type:"update",node:s}]]}function X(t,r,n="#"){const o=T(r,n);if("error"===o.type)return o;return t.validate(E(o),o.schema,o.pointer).flat(1/0).filter((t=>(0,e.isJSONError)(t)||t instanceof Promise))}function Y(t){const r=[],n=[];for(let o=0,i=t.length;o<i;o+=1)(0,e.isJSONError)(t[o])?r.push(t[o]):t[o]instanceof Promise&&n.push(t[o]);return[r,n]}function ee(e,t){t(e),j(e)&&e.children.forEach((e=>ee(e,t)))}async function te(t,r,n="#"){const o=T(r,n);if("error"===o.type)return o;const i={};ee(o,(e=>{e.errors=[],i[e.pointer]=e.errors}));const s=t.validate(E(o),o.schema,o.pointer).flat(1/0),[a,u]=Y(s);return a.forEach((e=>{var t,n;const o=null!==(n=null===(t=e.data)||void 0===t?void 0:t.pointer)&&void 0!==n?n:"#";null==i[o]&&(i[o]=T(r,o).errors),i[o].push(e)})),u.forEach((t=>t.then((t=>{(function(t){return[t].flat(1/0).filter(e.isJSONError)})(t).forEach((e=>{var t,r,n;const o=null!==(r=null===(t=e.data)||void 0===t?void 0:t.pointer)&&void 0!==r?r:"#";i[o]=null!==(n=i[o])&&void 0!==n?n:[],i[o].push(e)}))})))),Promise.all(u)}function re(e){const t=(0,q.split)(e);if(t.length>=1){const e=t.pop();return[(0,q.join)(t),e]}throw new Error(`There is no property for pointer '${e}'`)}function ne(e,t,r,n){n.forEach((t=>{e.forEach((e=>{const o=e.onEvent(r,t);o&&(r=o[0],n.push(...o[1]))}))}));const o={type:"done",previous:t,next:r,changes:n};return e.forEach((e=>e.onEvent(r,o))),r}class oe{constructor(t){this.changes=[],this.plugins=[];const{schema:r,data:n={},plugins:o=[],draftConfig:i}=t;this.options=t,this.draft=new e.JsonEditor(r,i),this.state=g(this.draft,this.draft.getTemplate(n)),o.map((e=>this.addPlugin(e))),setTimeout((()=>t.validate&&this.validate()))}setData(e){const{draft:t}=this,r=this.state;this.state=g(t,t.getTemplate(e)),!0===this.options.validate&&this.validate();const n=x(this.state).map((e=>({type:"create",node:e})));return this.state=ne(this.plugins,r,this.state,n),this.state}setSchema(e){return this.draft.setSchema(e),this.setData(E(this.state))}validate(){if(null==this.state)return;const e=G(this.state);te(this.draft,e);const t=P(this.state);this.state=ne(this.plugins,this.state,e,[{type:"validation",previous:this.state,next:e,errors:t}])}setState(e,t){return this.state=ne(this.plugins,this.state,e,t),this.state}getState(){return this.state}getNode(e){return e&&"string"==typeof e&&""!==e.replace(/^[/#]+/,"")?T(this.state,e):this.state}plugin(e){return this.plugins.find((t=>t.id===e))}addPlugin(e){const t=e(this,this.options);t&&t.id&&this.plugins.push(t)}setValue(t,r){const n=T(this.state,t);if(!(0,e.isJSONError)(n)){const e=E(n);if((0,D.deepEqual)(e,r))return this.state}const[o,i]=_(this.draft,this.state,t,r);if((0,e.isJSONError)(o))return console.error(`error setting '${t}' = ${r}`),console.log(o),this.state;if(void 0===i)throw new Error("invalid state");return te(this.draft,o,function(e){var t;let r=(null===(t=e[0])||void 0===t?void 0:t.node.pointer)||"#";return e.forEach((({node:e})=>{r.includes(e.pointer)&&(r=e.pointer)})),r}(i)),this.changes.push(...i),this.state=ne(this.plugins,this.state,o,i),this.state}removeValue(t){const[r,n]=Z(this.state,t);if((0,e.isJSONError)(r))return console.error(`error removing '${t}'`),console.log(r),this.state;if(void 0===n)throw new Error("invalid state");const[o]=re(t);return te(this.draft,r,o),this.changes.push(...n),this.state=ne(this.plugins,this.state,r,n),this.state}moveItem(t,r){const[n,o]=re(t);console.log("move",n,o,r);const[i,s]=B(this.draft,this.state,n,parseInt(o),r);if(console.log(s,i),(0,e.isJSONError)(i))return console.error(`error moving nodes in '${t}'`),console.log(i),this.state;if(void 0===s)throw new Error("invalid state");return te(this.draft,i,t),this.changes.push(...s),this.state=ne(this.plugins,this.state,i,s),this.state}appendItem(t,r){const n=this.draft.getTemplate(null,r),o=`${t.pointer}/${t.children.length}`,[i,s]=_(this.draft,this.state,o,n);if((0,e.isJSONError)(i))return console.error(`error apending item from schema '${t.pointer}'`),console.log(i),this.state;if(void 0===s)throw new Error("invalid state");te(this.draft,i,t.pointer);let a=ne(this.plugins,this.state,i,s);return(0,e.isJSONError)(a)&&(console.error(`error from state returned by plugins '${t.pointer}'`),console.log(a),a=i),this.state=a,this.state}getArrayAddOptions(e){const t=this.draft.getSchema(e.pointer,E(this.state));return this.draft.getChildSchemaSelection(e.children.length,t)}getTemplateData(e){return this.draft.getTemplate(null,e)}}const ie=()=>({id:"eventLogger",onEvent(e,t){console.log(t)}}),se=(t,r)=>{const n={},o={};function i(t,r){const n=T(t,o[r.pointer]);if((0,e.isJSONError)(n))return;const i=E(n).filter((e=>!(null==e||""===e))),[s,a]=K(t,r.pointer,{...r.schema,items:{...r.schema.items,enum:i}});return(0,e.isJSONError)(s)?void 0:[s,a]}return{id:"remoteEnumOptions",onEvent(t,r){if("create"===r.type&&r.node.options.syncEnum){const s=T(t,r.node.options.syncEnum.source);if(!(0,e.isJSONError)(s))return n[s.pointer]=r.node.pointer,o[r.node.pointer]=s.pointer,i(t,r.node)}if("update"===r.type){const s=r.node.pointer;if(o[r.node.pointer])return i(t,r.node);if(n[s]){const r=T(t,n[s]);if(!(0,e.isJSONError)(r))return i(t,r)}}}}},ae=(e,t)=>{const r=t.onChange;if("function"!=typeof r)return;return{id:"onChange",onEvent(e,t){"done"===t.type&&r(E(e),e)}}};function ue(e){const t=[{root:e.getState(),changes:[],updateCount:0}],r=[];function n(){return t[t.length-1]}return{id:"history",onEvent(e,o){const i=n();if("done"===o.type&&e!==(null==i?void 0:i.root)){const s=o.changes;t.length>0&&function(e,t){if(null==e||1!==e.changes.length||1!==t.length)return!1;const r=e.changes[0],n=t[0];return"update"===r.type&&"update"===n.type&&r.node.pointer===n.node.pointer&&("string"===r.node.type||"number"===r.node.type)}(n(),s)&&i.updateCount<=12?(i.root=e,i.changes=o.changes,i.updateCount++):t.push({root:e,changes:s,updateCount:0}),r.length=0}},undo(){if(t.length>1){const o=t.pop();r.unshift(o);const i=n();e.setState(i.root,[{type:"undo",previous:o.root,next:i.root}])}},redo(){if(r.length>0){const o=n(),i=r.shift();t.push(i),e.setState(i.root,[{type:"redo",previous:o.root,next:i.root}])}},getUndoCount:()=>t.length-1,getRedoCount:()=>r.length}}})(),o})()));